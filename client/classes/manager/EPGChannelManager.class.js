var EPGChannelManager={channelsURL:top.CHANNELS_URL,channelArray:[],currentChannel:null,channelList:null,init:function(){this.channelArray=top.ChannelManager.data;this.setChannelList()},getChannels:function(a){if(a){this.channelArray=a}else{this.channelArray=eval(top.fakeChannelList2)}this.setChannelList()},setChannelList:function(){this.channelList=new top.List(top.ListType.SCROLL_CYCLIC,null);this.channelList.setData(this.channelArray);this.loadEPG();return true},getChannelList:function(){return this.channelList.getData()},addChannel:function(b){this.channelArray.push(b)},getChannelIndex:function(c){if(c){for(var d=0;d<this.channelList.getLength();d++){if(this.channelList.getItem(d).id==c.id){return d}}}return null},getChannelById:function(c){if(c){for(var d=0;d<this.channelList.getLength();d++){if(this.channelList.getItem(d).id==c){return this.channelList.getItem(d)}}}return null},getCurrentChannel:function(){if(this.currentChannel==null){this.currentChannel=this.channelList.getItem()}return this.currentChannel},setCurrentChannel:function(b){this.currentChannel=b;if(this.channelList.getItem().id!=b.id){if(!isNaN(this.getChannelIndex(b))){this.channelList.setIndex(this.getChannelIndex(b))}}},getChannelIndex:function(c){if(c){for(var d=0;d<this.channelList.getLength();d++){if(this.channelList.getItem(d).id==c.id){return d}}}return null},getChannelByIndex:function(b){return((isNaN(b)||b==null)?null:this.channelList.getItem(b))},getChannelById:function(b){return this.getChannelByIndex(this.getChannelIndexByProperty("id",b))},getChannelIndexByProperty:function(j,k){var h=0,i=false;var l=this.channelList;var g=l.getLength();while(h<g&&!i){l.getItem(h)[j]==k?i=true:h++}return i?h:null},getChannelByNumber:function(b){return this.getChannelByIndex(this.getChannelIndexByProperty("number",b))},loadEitByChannel:function(c){if(c&&c.eitXML){a=c.eitXML;top.kwUtils.kwXMLHttpRequest("GET",a,true,this,this.loadEitByChannelCallback,{responseXML:true,id:c.id})}else{top.globalFireEvent(new top.Event("EIT_LOADED",{channelId:c.id,programs:[]}))}},loadEitByChannelCallback:function(x,q){var s=this.getChannelById(q.id);var u=[],i,p,r,j;var z,y,t;if(s&&x&&!x.error){i=x!=null?top.kwUtils.kwXpathGetNodes("//programme",x):[];for(var v=0;v<Math.min(i.length,2);v++){j=i[v];y=this.convertXMLDate(j.getAttribute("start"));t=this.convertXMLDate(j.getAttribute("stop"));for(var w=0;w<j.childNodes.length;w++){p=j.childNodes[w];r=top.kwUtils.kwXpathGetNodeContent(p);switch(p.nodeName){case"title":z=r;break}}u.push({name:z,startTime:y,endTime:t})}}top.globalFireEvent(new top.Event("EIT_LOADED",{channelId:q.id,programs:u}))},loadEPG:function(){var c=new Date();c.setHours(23,59,59);top.kwTimer.cancelTimer("LOAD_EPG");top.kwTimer.setTimer("LOAD_EPG",{scope:this,callback:this.loadEPG},top.EPG_LOAD_TIMEOUT);top.kwConsole.print("next EPG date is :: "+new Date(c.getTime()));for(var d=0;d<this.channelList.getLength();d++){this.loadEpgByChannel(this.channelList.getItem(d))}},loadEpgByChannel:function(c){if(c&&c.epgXML){var d=c.epgXML;top.kwUtils.kwXMLHttpRequest("GET",d,true,this,this.loadEpgByChannelCallback,{responseXML:true,id:c.id})}else{this.attachProgramlist(c.id)}},loadEpgByChannelCallback:function(z,r){var t=this.getChannelById(r.id);var w=[],i,q,s,j;var B,u,A,v;if(t&&z&&!z.error){i=z!=null?top.kwUtils.kwXpathGetNodes("//programme",z):[];for(var x=0;x<i.length;x++){j=i[x];A=this.convertXMLDate(j.getAttribute("start"));v=this.convertXMLDate(j.getAttribute("stop"));for(var y=0;y<j.childNodes.length;y++){q=j.childNodes[y];s=top.kwUtils.kwXpathGetNodeContent(q);switch(q.nodeName){case"title":B=s;break;case"desc":u=s;break}}w.push({name:B,description:u,startTime:A,endTime:v})}}this.attachProgramlist(r.id,w)},attachProgramlist:function(f,e){var d=this.getChannelById(f);if(d){d.programs=e||[]}},fixEpgProgramListByChannel:function(g){var h=top.Clock.getCurrentTime();if(g&&g.id){var f=this.getChannelById(g.id);for(var e=0;e<f.programs.length;e++){if(f.programs[e].endTime<h){f.programs.splice(e,1);e--}}return f.programs}return null},convertXMLDate:function(d){var c=new Date();c.setFullYear(d.substr(0,4),d.substr(4,2)-1,d.substr(6,2));c.setHours(d.substr(8,2),d.substr(10,2),d.substr(12,2));return c.getTime()},channelUp:function(b){this.channelList.scrollDown();if(b==true){this.setCurrentChannel(this.channelList.getItem())}},channelDown:function(b){this.channelList.scrollUp();if(b==true){this.setCurrentChannel(this.channelList.getItem())}}};