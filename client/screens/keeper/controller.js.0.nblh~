var userCode="";
var roomList=null;
var roomOrderList=null;
var requestedTime=0;
var selectedTime="00:00"
var requestedDateDiff=0;
var requestedDateDate=null;
var requestedGuest=1;
function roomEventHandler(a){
    var b=true;
    switch(a.code){
        case"INIT_SCREEN":
            roomInitScreen(a.args);
            break;
        case"UNINIT_SCREEN":
            roomUninitScreen();
            break;
        default:
            switch(top.State.getState()){
                case top.State.SERVICE_LIST:
                    b=roomMainEventHandler(a);
                    break;
                case top.State.SERVICE_ORDER:
                    b=roomOrderMainEventHandler(a);
                    break;                 
                default:
                    b=false;
                    break
            }
            break
    }
    return b
}


function roomMainEventHandler(a){
    var b=true;
    switch(a.code){
        case"KEY_RIGHT":
            top.State.setState(top.State.SERVICE_ORDER);
            roomListHideHighlight();
            roomOrderListShowHighlight();
            //roomOrderList.scrollFirst()
            break;
        case "KEY_UP":
            roomList.scrollUp(1);
            switchRoomService();
            roomOrderListHideHighlight();
            break;
        case "KEY_DOWN":
            try{
                roomList.scrollDown(1);
                switchRoomService();
                roomOrderListHideHighlight(); 
            }catch(err)
            {
                x=err;
            }
            break;
        case "KEY_BACK":
            top.ScreenManager.load("MENU");
            break;
        case "KEY_SELECT":
            top.State.setState(top.State.SERVICE_ORDER);
            roomListHideHighlight();
            roomOrderListShowHighlight();
            //roomOrderList.scrollFirst()
            break;
        default:
            b=false;
            break
    }
    return b
}

function  switchRoomService()
{
    if(roomList.getItem().target=="taxi")
    {
        roomInitOrderListTaxi();                 
    }else
    {
        roomInitOrderList();                        
    }
    requestedDateDiff=0
    requestedTime=0
    requestedGuest=1
}


function roomOrderMainEventHandler(a){
    var b=true;
    switch(a.code){
        case"KEY_LEFT":
            try{
                if(roomOrderList.getItem().target=="time" && requestedTime> 0 )
                {
                    requestedTime--;
                    top.Time.setTime(requestedTime);
                    if(document.getElementById("serviceorderTime")){
                        document.getElementById("serviceorderTime").innerHTML=top.Time.getSelectedTime();
                    }
                } 
                else if(roomOrderList.getItem().target=="guest" && requestedGuest>1)
                {
                    requestedGuest--;
                    if(document.getElementById("serviceorderGuest")){
                        document.getElementById("serviceorderGuest").innerHTML=requestedGuest;
                    }
                }
                else if(roomOrderList.getItem().target=="date" && requestedDateDiff>0)
                {
                    requestedDateDiff--;
                    if(document.getElementById("serviceorderDate")){
                        document.getElementById("serviceorderDate").innerHTML=top.Clock.addDays(requestedDateDiff,"dd - M - yyyy");
                    }
                }
            }catch(err)
            {
                x1=err;
            }
            break;
        case"KEY_RIGHT":
            if(roomOrderList.getItem().target=="time" && top.Time.getMaxIndex()> requestedTime)
            {
                requestedTime++;
                top.Time.setTime(requestedTime);
                if(document.getElementById("serviceorderTime")){
                    selectedTime=top.Time.getSelectedTime();
                    document.getElementById("serviceorderTime").innerHTML=selectedTime;
                }
            }             
            else if(roomOrderList.getItem().target=="guest" && requestedGuest<100)
            {
                requestedGuest++;
                if(document.getElementById("serviceorderGuest")){
                    document.getElementById("serviceorderGuest").innerHTML=requestedGuest;
                }
            }
            else if(roomOrderList.getItem().target=="date" && requestedDateDiff<100)
            {
                requestedDateDiff++;
                if(document.getElementById("serviceorderDate")){
                    document.getElementById("serviceorderDate").innerHTML=top.Clock.addDays(requestedDateDiff,"dd - M - yyyy");
                }
            }
            break;
        case"KEY_CODE":
            top.kwConsole.print("KEY CODE");           
            userCode+=""+a.args.value
            top.kwConsole.print(userCode);
            break;
        case "KEY_RED":
            userCode = userCode.substring(0, userCode.length - 1);
            top.kwConsole.print(userCode);
            break;
        case "KEY_UP":
            roomOrderList.scrollUp(1);
            break;
        case "KEY_DOWN":
            try{
                roomOrderList.scrollDown(1);
            }catch(err)
            {
                x=err;
            }
            break;
        case "KEY_BACK":
            top.State.setState(top.State.SERVICE_LIST);
            roomListShowHighlight();
            roomOrderListHideHighlight();
            break;
        case "KEY_SELECT":
            if(roomOrderList.getItem().target=="submit")
            {              
                document.getElementById("servicemsg").innerHTML="Thank You. Your Request will be processed.";
                top.RoomKeeperManager.setServiceRequest(roomList.getItem().target,selectedTime,requestedDateDiff,requestedGuest);
            }else
            {
                document.getElementById("servicemsg").innerHTML="Enter requered order information..";
            }
            break;
        default:
            b=false;
            break
    }
    return b
}

function roomInitScreen(a){
    top.State.setState(top.State.SERVICE_LIST);
    top.ScreenManager.displayScreen(roomGetScreenHtml());
    top.Clock.show(this,"globalClock");
    roomInitMainList()
    roomInitOrderList();
    top.Time.init();
}
function roomUninitScreen(){
    top.Clock.stop();
}
function roomInitMainList(){
    try{
        var a=[];
        roomList=new top.List(top.ListType.BLOCK,roomListData(),0,0,0,9,document.getElementById("roomListContainer"));
        roomList.displayItem=roomListDisplayItem;
        roomList.displayEmptyList=roomListDisplayEmptyList;
        roomList.display=roomListDisplay;
        roomList.onBeforeDisplay=roomListShowHighlight;
        roomList.onIndexChanged=roomListOnIndexChanged;
        roomList.onAfterDisplay=roomListOnAfterDisplay;
        roomList.initList()
        
    }catch(err)
    {
        x=err;
    }
};

function roomInitOrderList(){
    try{
        var a=[];
        roomOrderList=new top.List(top.ListType.BLOCK,roomOrderListData(),0,0,0,3,document.getElementById("roomInfoContainerContent"));
        roomOrderList.displayItem=roomOrderListDisplayItem;
        roomOrderList.displayEmptyList=roomOrderListDisplayEmptyList;
        roomOrderList.display=roomOrderListDisplay;
        roomOrderList.onBeforeDisplay=roomOrderListShowHighlight;
        roomOrderList.onIndexChanged=roomOrderListOnIndexChanged;
        roomOrderList.onAfterDisplay=roomOrderListOnAfterDisplay;
        roomOrderList.initList()
        roomOrderListHideHighlight();
        
    }catch(err)
    {
        x=err;
    }
};

function roomInitOrderListTaxi(){
    try{
        var a=[];
        roomOrderList=new top.List(top.ListType.BLOCK,roomOrderListDataTaxi(),0,0,0,4,document.getElementById("serviceInfoContainerContent"));
        roomOrderList.displayItem=roomOrderListDisplayItem;
        roomOrderList.displayEmptyList=roomOrderListDisplayEmptyList;
        roomOrderList.display=roomOrderListDisplay;
        roomOrderList.onBeforeDisplay=roomOrderListShowHighlight;
        roomOrderList.onIndexChanged=roomOrderListOnIndexChanged;
        roomOrderList.onAfterDisplay=roomOrderListOnAfterDisplay;
        roomOrderList.initList()
        
    }catch(err)
    {
        x=err;
    }
};


function roomListData(){
    var b=[];
    b.push({
        "class":"vacant_status",
        target:"vacant_status"
    });
    b.push({
        "class":"turn_down",
        target:"turn_down"
    });
    b.push({
        "class":"under_maintenance",
        target:"under_maintenance"
    });
    b.push({
        "class":"maintenance_req",
        target:"maintenance_req"
    });
    b.push({
        "class":"extra_bed",
        target:"extra_bed"
    });
    b.push({
        "class":"cleaning_req",
        target:"cleaning_req"
    });
    b.push({
        "class":"baby_cot",
        target:"baby_cot"
    });
    return b
};
function roomOrderListData(){
    var b=[];
    b.push({
        "class":"serviceorderTime",
        target:"time"
    });
    b.push({
        "class":"serviceorderDate",
        target:"date"
    }); 
    b.push({
        "class":"serviceorderSubmit",
        target:"submit"
    });
    return b
}

function roomOrderListDataTaxi(){
    var b=[];
    b.push({
        "class":"serviceorderTime",
        target:"time"
    });
    b.push({
        "class":"serviceorderDate",
        target:"date"
    });
    b.push({
        "class":"serviceorderGuest",
        target:"guest"
    });
    b.push({
        "class":"serviceorderSubmit",
        target:"submit"
    });
    return b
}
